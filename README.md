# 六壬神課金口訣システム

## kinkoketsuCalc クラス定義仕様書

### 1. 目的
本クラスは、金口訣（大六壬金口訣）における「四位（しい）」を、入力された暦情報および地分から一意に算出することを目的とする。

### 2. クラス構造
* **クラス名**: `kinkoketsuCalc`
* **主要役割**: 入力パラメータに基づき、人元（じんげん）、貴神（きしん）、将神（しょうしん）、地分（ちぶん）の4つの要素を特定する。

### 3. 入力パラメータ (Constructor)

| 引数名 | 記号 | 型 | 内容 | 範囲 |
| :--- | :--- | :--- | :--- | :--- |
| `diBun` | $D$ | `Number` | 地分（地支インデックス） | 1 (子) ～ 12 (亥) |
| `getSho` | $M$ | `Number` | 月将（地支インデックス） | 1 (子) ～ 12 (亥) |
| `tokiShi` | $T$ | `Number` | 時支（地支インデックス） | 1 (子) ～ 12 (亥) |
| `nichiKan` | $H$ | `Number` | 日干（天干インデックス） | 1 (甲) ～ 10 (癸) |
| `isNight` | $N$ | `Boolean` | 夜間判定フラグ | `true` (夜) / `false` (昼) |

### 4. 算出アルゴリズム

#### 4.1 将神 (ShoShin) の算出
月将を時支に載せ、地分まで時計回りに配布する相対計算を行う。
* **数式**: $S = (M - T + D + 12) \pmod{12}$
* **例外処理**: 結果が $0$ の場合は $12$ (亥) とする。
* **名称対応**: 算出されたインデックスに基づき、神后(1)〜登明(12)の名称を付与する。

#### 4.2 貴神 (KiShin) の算出
日干と昼夜から「貴人」の起点を決定し、その位置から地分までの距離を算出して天将を特定する。

1. **起点 $K$ の決定**:
   * 甲(1)・戊(5)・庚(7) : 昼=丑(2), 夜=未(8)
   * 乙(2)・己(6) : 昼=子(1), 夜=申(9)
   * 丙(3)・丁(4) : 昼=亥(12), 夜=酉(10)
   * 辛(8) : 昼=午(7), 夜=寅(3)
   * 壬(9)・癸(10) : 昼=巳(6), 夜=卯(4)
2. **順逆 $Dir$ の判定**:
   * 起点 $K \in \{12, 1, 2, 3, 4, 5\}$ ならば **順行 ($Dir = 1$)**
   * 起点 $K \in \{6, 7, 8, 9, 10, 11\}$ ならば **逆行 ($Dir = -1$)**
3. **天将インデックス $Idx$ の算出**:
   * $Idx = ((D - K) \times Dir + 12) \pmod{12} + 1$
   * この $Idx$ を用いて十二天将リスト（貴人(1)〜天后(12)）から名称を取得する。
4. **貴神の天干**:
   * 人元と同じく「五子元遁」を用いて、地分 $D$ 上に巡る天干を付与する。

#### 4.3 人元 (JinGen) の算出
「五子元遁（ごしげんとん）」に基づき、日干から導かれる「子」の天干を起点として地分までの天干を特定する。

1. **起点天干 $S_{kan}$ の決定**:
   * 甲己(1,6) → 甲(1)
   * 乙庚(2,7) → 丙(3)
   * 丙辛(3,8) → 戊(5)
   * 丁壬(4,9) → 庚(7)
   * 戊癸(5,10) → 壬(9)
2. **人元 $J$ の算出**:
   * $J = (S_{kan} + (D - 1) + 10) \pmod{10}$
   * ※結果が $0$ の場合は $10$ (癸) とする。

### 5. 出力データ構造 (Output)
`getResults()` メソッドは以下のオブジェクトを返却する。

```json
{
  "jinGen": "天干文字",
  "kiShin": "天干 + 地支 + (天将名)",
  "shoShin": "地支 + (月将名)",
  "diBun": "地支文字"
}
