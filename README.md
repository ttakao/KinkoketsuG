# KInkogetsuG 六壬神課金口訣システム

このソフトウェアは六壬神課金口訣の課を作り（起課）、標準的なルールで解釈までするものです。
これらの方法は日本の本はまったく使っていません。Google Geminiが中国語圏から入手した情報から作成しています。
作者が確認しても、あきらかに日本語で書かれた本とは違う方法を取っています。
2026年上半期のAIでここまでできるという研究の一端でもあります。

構成は極めてシンプルで、
index.html, manual.html, kinkoketsuCalc.js, kinkoketsuJudge.js
の4ファイルのみです。
なお、マニュアルは競馬での使い方に特化しています。

<https://ttakao.github.io/KinkoketsuG/>

で実働を見ることができます。

クラスライブラリーの詳細は以下に記載してあります。

## kinkoketsuCalc クラス定義仕様書

### 1. 目的

本クラスは、金口訣（大六壬金口訣）における「四位（しい）」を、入力された暦情報および地分から一意に算出することを目的とする。

### 2. クラス構造

* **クラス名**: `kinkoketsuCalc`
* **主要役割**: 入力パラメータに基づき、人元（じんげん）、貴神（きしん）、将神（しょうしん）、地分（ちぶん）の4つの要素を特定する。

### 3. 入力パラメータ (Constructor)

| 引数名 | 記号 | 型 | 内容 | 範囲 |
| :--- | :--- | :--- | :--- | :--- |
| `diBun` | $D$ | `Number` | 地分（地支インデックス） | 1 (子) ～ 12 (亥) |
| `getSho` | $M$ | `Number` | 月将（地支インデックス） | 1 (子) ～ 12 (亥) |
| `tokiShi` | $T$ | `Number` | 時支（地支インデックス） | 1 (子) ～ 12 (亥) |
| `nichiKan` | $H$ | `Number` | 日干（天干インデックス） | 1 (甲) ～ 10 (癸) |
| `isNight` | $N$ | `Boolean` | 夜間判定フラグ | `true` (夜) / `false` (昼) |


### 4. 算出アルゴリズム



#### 4.1 将神 (ShoShin) の算出

月将を時支に載せ、地分まで時計回りに配布する相対計算を行う。

* **数式**: $S = (M - T + D + 12) \pmod{12}$
* **例外処理**: 結果が $0$ の場合は $12$ (亥) とする。
* **名称対応**: 算出されたインデックスに基づき、神后(1)〜登明(12)の名称を付与する。

#### 4.2 貴神 (KiShin) の算出

日干と昼夜から「貴人」の起点を決定し、その位置から地分までの距離を算出して天将を特定する。


1. **起点 $K$ の決定**:
   * 甲(1)・戊(5)・庚(7) : 昼=丑(2), 夜=未(8)
   * 乙(2)・己(6) : 昼=子(1), 夜=申(9)
   * 丙(3)・丁(4) : 昼=亥(12), 夜=酉(10)
   * 辛(8) : 昼=午(7), 夜=寅(3)
   * 壬(9)・癸(10) : 昼=巳(6), 夜=卯(4)
2. **順逆 $Dir$ の判定**:
   * 起点 $K \in \{12, 1, 2, 3, 4, 5\}$ ならば **順行 ($Dir = 1$)**
   * 起点 $K \in \{6, 7, 8, 9, 10, 11\}$ ならば **逆行 ($Dir = -1$)**
3. **天将インデックス $Idx$ の算出**:
   * $Idx = ((D - K) \times Dir + 12) \pmod{12} + 1$
   * この $Idx$ を用いて十二天将リスト（貴人(1)〜天后(12)）から名称を取得する。
4. **貴神の天干**:
   * 人元と同じく「五子元遁」を用いて、地分 $D$ 上に巡る天干を付与する。

#### 4.3 人元 (JinGen) の算出

「五子元遁（ごしげんとん）」に基づき、日干から導かれる「子」の天干を起点として地分までの天干を特定する。

1. **起点天干 $S_{kan}$ の決定**:
   * 甲己(1,6) → 甲(1)
   * 乙庚(2,7) → 丙(3)
   * 丙辛(3,8) → 戊(5)
   * 丁壬(4,9) → 庚(7)
   * 戊癸(5,10) → 壬(9)
2. **人元 $J$ の算出**:
   * $J = (S_{kan} + (D - 1) + 10) \pmod{10}$
   * ※結果が $0$ の場合は $10$ (癸) とする。

### 5. 出力データ構造 (Output)

`getResults()` メソッドは以下のオブジェクトを返却する。

```json
{
  "jinGen": "天干文字",
  "kiShin": "天干 + 地支 + (天将名)",
  "shoShin": "地支 + (月将名)",
  "diBun": "地支文字"
}
```

## kinkoketsuJudge クラス定義仕様書

### 1. 役割

`kinkoketsuCalc` で出力された四位（元・神・将・地）に対し、五行論的な重み付けと意味付けを行い、最終的な判定結果および数値を導き出す。

### 2. 内部メソッドと処理順序

#### ① `convertElement()` (五行変換)

* 十二支・天干を五行(1:木, 2:火, 3:土, 4:金, 5:水)に変換。

#### ② `checkFiveMoves()` (五動判定)

* 四位間の生克関係をスキャンし、発生している「動」を特定する。
* 例: `if (jinGen.element克kiShin.element) return "妻動";`
五動は金口訣において「事態がどのように動こうとしているか」を定義する最も重要なロジックです。漢文の歌訣では難解に書かれていますが、プログラム的には**「四位のどの層とどの層が相克（攻撃）関係にあるか」**というフラグ判定に集約されます。

##### 五動の定義（アルゴリズム仕様）

四位の上下関係において、以下の相克（一方が一方を負かす関係）が発生したとき、それぞれの「動」が成立します。

| 名称 | 条件 | 占術的意味 |
| :--- | :--- | :--- |
| 妻動 (さいどう) | 人元 → 克 → 貴神 | 金運、女性、外部からの管理、目下とのトラブル。|
| 官動 (かんどう) | 貴神 → 克 → 将神 | 仕事、官職、公的トラブル、目上や権力との関わり。|
| 財動 (ざいどう) | 将神 → 克 → 地分 | 具体的な利益、商売、不動産、足元の利得。|
| 賊動 (ぞくどう) | 地分 → 克 → 将神 | 内部の裏切り、盗難、予期せぬ損失、詐欺。|
| 鬼動 (きどう) | 貴神 → 克 → 人元 | 精神的不安、怪異、予期せぬ大きな災難、目下からの反撃。|

#### ③ `applyWeight()` (旺相休囚死)

* 引数として「月支（季節）」を受け取り、各要素のエネルギー値を補正。
* 旺(+2), 相(+1), 休(0), 囚(-1), 死(-2) のスコアリング。

占う日の「月支（季節）」を基準に、各五行のステータスを判定します。

| ステータス | 判定条件(5行との関係) | パワー係数 | 意味 |
| :--- | :--- | :--- | :--- |
| 旺 (おう) | 月支と同じ五行 | 2.0 | 最強。エネルギーが満ち溢れている |
| 相 (そう) | 月支が生み出す五行 (月支 → 生) | 1.5 | 強い。勢いがあり発展する。 |
| 休 (きゅう) | 月支を生む五行 (月支 ← 生) | 1.0 | 普通。休息状態だが悪くはない。 |
| 囚（しゅう） | 月支を克す五行 (月支 ← 克) | 0.5 | 弱い。力が抑制され、動きが鈍い。 |
| 死（し） | 月支に克される五行 (月支 → 克) | 0.0 | 無力。エネルギーが枯渇している。|

#### ④ `checkShinSatsu()` (神煞フラグ)

神煞とは、日干・日支などの「暦の条件」によって、特定の十二支に付与される特殊な「意味」や「効果」のことである。プログラム的には、算出した四位の支に対して 「特記事項（Metadata）」 を付与し、最終的なスコアやメッセージを補正する役割を持つ。

特に重要で、プログラムに即組み込むべき3種類

##### ① 空亡（くうぼう）：無効化フラグ

最も強力な神煞。これが付いた要素は、五行が「旺」であっても**「実体がない」**とみなされ、効果がゼロになります。
diff 計算（旬の特定）は、以下の数理に基づいています。

(日支Idx - 日干Idx + 12) % 12

この値が 0 なら戌亥空亡、10 なら申酉空亡...というマッピングです。

判定: 日柱の干支（六十干支）から算出される。
効果: power = 0 あるいは isValid = false。

##### ② 天馬（てんま）：加速フラグ

事態の進展が非常に速いことを示します。

判定: 日支（占う日の十二支）から算出。

寅・午・戌の日 ⇒ 申 が馬
申・子・辰の日 ⇒ 寅 が馬
亥・卯・未の日 ⇒ 巳 が馬
巳・酉・丑の日 ⇒ 亥 が馬

効果: speed = "Fast"。

##### ③ 徳（とく）：救済フラグ

凶を吉に変える、あるいは困難を回避するフラグ。

判定: 日干（甲〜癸）によって決まる特定の支。
効果: isProtected = true。

### 3. 最終出力 (取数アルゴリズム)

* 先天数の定義:
各五行には固有の数字が割り当てられています。

| 本命五行 | 先天数 (Target Number) |
| :--- | :--- |
| 水 | 1, 6 |
| 火 | 2, 7 |
| 木 | 3, 8 |
| 金 | 4, 9 |
| 土 | 5, 10(0) |

* スコアリング

+ ベース: 旺相休囚死のパワー値（0.0 ～ 2.0）を基本スコアとします。
+ 五動ボーナス: 「財動」や「官動」に関わる主体の五行に加点します。
+ 神煞ペナルティ: 「空亡」がついた要素のスコアは強制的に 0 とします。

* 最終判断
合計スコアが最も高い五行を「本命」とし、その先天数を出力します。
